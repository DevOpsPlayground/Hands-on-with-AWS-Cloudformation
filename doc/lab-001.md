
# Lab-001 - Create a CloudFormation Stack

[Home](../README.md) |
[AWS Console](https://console.aws.amazon.com) |
Slides |
[Anatomy](anatomy.md) |
lab-001 |
[lab-002](lab-002.md) |
[lab-003](lab-003.md) |
[lab-004](lab-004.md) |
[lab-005](lab-005.md) |
[lab-006](lab-006.md)


## GOAL: Provision a S3 Bucket with a custom name
During the lab session you will get a understanding of:
- CloudFormation Template Structure
- Use of `Parameters`
- Applying `Metadata` using the `AWS::CloudFormation::Interface`
- Use of `Resources` for provisioning


![lab-001 S3 Bucket](https://raw.githubusercontent.com/sunil-tailor/lab_cloudformation/master/diagrams/lab-001.png)

## Overview
- __Template__ - is uploaded to CloudFormation service and stored in S3 bucket which CloudFormation service will create.
- __CloudFormation__ - will process the template when you create a stack.
- __S3__ - AWS service used to provisioned resource.
- __Custom Bucket__ - Resource provisioned by CF template. The template will publish the bucket name as part of the template output.


## Lab Session - AWS Console

Log into AWS Console and navigate to CloudFormation Service.

1. Services > Management Tools > CloudFormation

### Steps
1. Click __'Create Stack'__ Button

__Select template:__
1. Choose __"Upload a template to Amazon S3"__
1. Upload file "lab-001_S3Bucket.yaml"
1. Click __"Next"__

__Specify Details:__
1. Stack Details > __Stack Name__ : `lab-001-<YOUR NAME>`
1. Parameters:
   - Lab-001: S3 Bucket > __Bucket Name__ : `pg19-<YOUR NAME>`
1. Click 'Next'

__Options:__
1. Permissions > IAM Role: `productionAccessRole`
1. Click 'Next'

__Review:__
1. Click 'Create'


## Analysis of Lab

- Reviewed CloudFormation Template
- Created CloudFormation Stack
- Viewed the output of a CloudFormation Stack

During this lab you provisioned a S3 bucket using a parameterise bucket name.



# Notes
- __Stack name__ - must contain only letters, numbers, dashes and start with an alpha character.

#### Metadata



#### AWS::CloudFormation::Interface
`AWS::CloudFormation::Interface` is a metadata key that defines how parameters are grouped and sorted in the AWS CloudFormation console. Its only used on AWS Console, AWS CLI and API do not use this metadata key.




## Using AWS CLI

#### Validate your template
```
aws cloudformation validate-template \
--template-body file://cf-lab-001.yaml \
--profile training
{
    "Parameters": []
}
```

#### Run

```
aws cloudformation create-stack \
--stackname lab-001-<YOUR NAME> \
--template-body file://lab-001_S3Bucket.yaml \
--parameters file://lab-001-parameters.json
```

##### Sample Parameter
```
[
  {
    "ParameterKey": "pS3BucketName",
    "ParameterValue": "sample-use-case-001"
  }
]
```


## Further Reading
1. AWS doc - CloudFormation > [AWS::CloudFormation::Interface](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-cloudformation-interface.html)
1. AWS API - CloudFormation > [AWS::S3::Bucket](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-s3-bucket.html)
1. AWS API - CloudFormation > [AWS::S3::BucketPolicy](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-s3-policy.html)


## References
